 
 
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>浩宇建设 - 项目部</title>
<link rel="stylesheet" href="static/layui/css/layui.css">
<link rel="stylesheet" href="static/layui/css/global.css">
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
    <div class="layui-logo">项目管理部·成本控制</div>
    <!-- 头部区域（可配合layui已有的水平导航） -->
    <ul class="layui-nav layui-layout-left">
      <li class="layui-nav-item"><a href="index">首页</a></li>
      <li class="layui-nav-item"><a href="project">项目管理</a></li>
      <li class="layui-nav-item"><a href="company">供应商管理</a></li>
      <li class="layui-nav-item"><a href="contract">合同管理</a></li>
      <li class="layui-nav-item"><a href="finace">财务管理</a></li>
    </ul>

    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item">
        <a href="javascript:;">
          <img src="http://t.cn/RCzsdCq" class="layui-nav-img">
          admin
        </a>
        <dl class="layui-nav-child">
          <dd><a href="javascript:;">基本资料</a></dd>
          <dd><a href="javascript:;">安全设置</a></dd>
        </dl>
      </li>
      <li class="layui-nav-item"><a href="javascript:;">退出</a></li>
    </ul>
  </div>
  
  
  
  <div class="layui-body">
    <!-- 内容主体区域 -->
    <span class="layui-breadcrumb">
      <a href="javascript:;">首页</a>
      <a href="javascript:;"><cite>项目管理</cite></a>
    </span>
    <hr>
    <blockquote class="layui-elem-quote">公告：暂无</blockquote>
    <div class="layui-tab layui-tab-brief">
      <ul class="layui-tab-title">
        <li class="layui-this">项目新增</li>
        <li>项目查阅</li>
        <li>标段新建</li>
        <li>标段查阅</li>
      </ul>
      <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
          <form class="layui-form" action="">
            <div class="layui-form-item">
              <label class="layui-form-label">项目名称</label>
              <div class="layui-input-inline">
                <input type="text" name="proName" required  lay-verify="required" placeholder="请输入项目名称" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">项目编号</label>
              <div class="layui-input-inline">
                <input type="text" name="proNumber" required  lay-verify="number" placeholder="请输入项目编号" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">项目总造价</label>
              <div class="layui-input-inline">
                <input type="text" name="proPrice" required  lay-verify="number" placeholder="请输入项目总造价" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">万</div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">开工日期</label>
              <div class="layui-input-inline">
                <input type="text" id="proStart" name="proStart" required  lay-verify="date" placeholder="请选择项目开工日期" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">工期</label>
              <div class="layui-input-inline">
                <input type="text" name="proDays" required  lay-verify="number" placeholder="请输入项目工期" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">天</div>
            </div>            
            
            <div class="layui-form-item layui-form-text">
              <label class="layui-form-label">备注</label>
              <div class="layui-input-block">
                <textarea name="proRemark" class="layui-textarea"></textarea>
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block">
                <input type="hidden" name="proAC" value="project" />
                <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
              </div>
            </div>
          </form>
        </div>
        <div class="layui-tab-item">
          <table id="proList" lay-filter="proList"></table>
        </div>
        <div class="layui-tab-item layui">
          <form class="layui-form" action="">
            <div class="layui-form-item">
              <label class="layui-form-label">项目名称</label>
              <div class="layui-input-inline" id="proIdLine">
                <select id="proId" name="proId" lay-verify="proId" lay-filter="proId" lay-search>
                </select>
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">标段名称</label>
              <div class="layui-input-inline">
                <input type="text" name="bidsName" required  lay-verify="required" placeholder="请输入标段名称" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">项目经理</label>
              <div class="layui-input-inline">
                <select id="managerId" name="managerId" lay-verify="managerId" lay-filter="proId" lay-search>
                </select>
              </div>
              <i class="layui-icon layui-icon-add-circle" style="font-size: 32px; color: #009688;cursor: pointer"></i>
            </div>
            <div class="layui-form-item layui-form-text">
              <label class="layui-form-label">备注</label>
              <div class="layui-input-block">
                <textarea name="bidsRemark" placeholder="请输入内容" class="layui-textarea"></textarea>
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block">
                <input type="hidden" name="proAC" value="bids" />
                <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
              </div>
            </div>            
          </form>
        </div>
        <div class="layui-tab-item">
	          <table id="bidsList" lay-filter="bidsList"></table>
	        </div>
      </div>
    </div>
  </div>
  
  <div class="layui-footer">
    <!-- 底部固定区域 -->
    © 湖南浩宇建设有限公司 - Lee.
  </div>
</div>
<script src="static/layui/layui.js"></script>
<script type="text/html" id="colBar">
  <a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
//JavaScript代码区域
layui.use('element', function(){
  var element = layui.element,
  $ = layui.$;

  refreshProjectOption();
  refreshProjectList();
  refreshBidsList();
});
layui.use('form', function(){
  var form = layui.form;
  var $ = layui.$;  
  //监听提交
  form.on('submit(formDemo)', function(data){
    $.ajax({
      url:'/project/add',
      method:'post',
      data:data.field,
      dataType:'JSON',
      success:function(res){        
        layer.msg(res.msg);
        //parent.closeIframe(res.msg);
      },
      error:function (data) {
      }
    })
    return false;
  });
});
layui.use('laydate', function(){
  var laydate = layui.laydate;
  
  //执行一个laydate实例
  laydate.render({
    elem: ['#proStart',] //指定元素
  });
});
window.refreshProjectOption = function() {
  layui.use('form', function(){
    var form = layui.form;
    var $ = layui.$;  
    $.ajax({
      url:'/project/query',
      method:'GET',
      dataType:'JSON',
      success:function(res){   
        var num = res.data.length;
        var option = "";
        res.data.forEach( function(element, index) {
          option += "<option value='"+element.proId+"'>"+element.proName+"</option>";
          $("#proId").html(option)
        });
        form.render('select');
      }
    });
  });
}
window.refreshProjectList = function(){
  layui.use(['table','layer'], function(){
    var table = layui.table,
    layer = layui.layer;
    
    //项目表格
    table.render({
      elem: '#proList'
      ,height: 315
      ,url: '/project/query' //数据接口
      ,page: true //开启分页
      ,cols: [[ //表头
        {field: 'proNumber', title: '项目编号',width: 100, sort: true, fixed: 'left'}
        ,{field: 'proName', title: '项目名称'}
        ,{field: 'proPrice', title: '项目总造价',width: 120}
        ,{field: 'proStart', title: '开工日期',width: 120}
        ,{field: 'proDays', title: '工期（天）',width: 100} 
        ,{field: 'proRemark', title: '备注'}
        ,{field: 'proEdit', title: '操作',fixed:'right', align:'center', toolbar: '#colBar'}
      ]]
    });

    table.on('tool(proList)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
      var data = obj.data; //获得当前行数据
      var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
      var tr = obj.tr; //获得当前行 tr 的DOM对象
     
      if(layEvent === 'detail'){ //查看
        console.log(data);
        //do somehing
      } else if(layEvent === 'del'){ //删除
        layer.confirm('真的删除行么', function(index){
          obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
          layer.close(index);
          //向服务端发送删除指令
        });
      } else if(layEvent === 'edit'){ //编辑
        //do something
        
        //同步更新缓存对应的值
        obj.update({
          username: '123'
          ,title: 'xxx'
        });
      }
    });
  });
}
window.refreshBidsList = function(){
  layui.use('table', function(){
    var table = layui.table;
    
    ///标段表格
    table.render({
      elem: '#bidsList'
      ,height: 315
      ,url: '/project/query' //数据接口
      ,page: true //开启分页
      ,cols: [[ //表头
        {field: 'proId', title: '序号', width:100, sort: true, fixed: 'left'}
        ,{field: 'proName', title: '标段名称', width:360}
        ,{field: 'proStart', title: '开工日期', width:180}
        ,{field: 'proDays', title: '工期（天）', width:100} 
        ,{field: 'proRemark', title: '备注'}
        ,{field: 'proEdit', title: '编辑',width:100}
      ]]
    });
  })
}
</script>
</body>
</html>

