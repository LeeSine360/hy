{include file="../application/view/public/header.html" /}

  <div class="layui-body">
    <!-- 内容主体区域 -->
    <span class="layui-breadcrumb">
      <a href="javascript:;">首页</a>
      <a href="javascript:;"><cite>项目管理</cite></a>
    </span>
    <hr>
    <blockquote class="layui-elem-quote">公告：暂无</blockquote>
    <div class="layui-tab layui-tab-brief" lay-filter="tab">
      <ul class="layui-tab-title">
        <li class="layui-this">项目新建</li>
        <li>项目查询</li>
        <li>标段新建</li>
        <li>标段查询</li>
      </ul>
      <div class="layui-tab-content">
        <div class="layui-tab-item layui-show">
          <form class="layui-form" action="">            
            <div class="layui-form-item">
              <label class="layui-form-label">项目名称</label>
              <div class="layui-input-inline">
                <input type="text" name="proName" required  lay-verify="required" placeholder="请输入项目名称" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">项目编号</label>
              <div class="layui-input-inline">
                <input type="text" name="proNumber" required  lay-verify="number" placeholder="请输入项目编号" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">项目总造价</label>
              <div class="layui-input-inline">
                <input type="text" name="proPrice" required  lay-verify="number" placeholder="请输入项目总造价" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">元</div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">开工日期</label>
              <div class="layui-input-inline">
                <input type="text" id="proStart" name="proStart" required  lay-verify="date" placeholder="请选择项目开工日期" autocomplete="off" class="layui-input">
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">工期</label>
              <div class="layui-input-inline">
                <input type="text" name="proDays" required  lay-verify="number" placeholder="请输入项目工期" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">天</div>
            </div>            
            
            <div class="layui-form-item layui-form-text">
              <label class="layui-form-label">合同内容</label>
              <div class="layui-input-block">
                <textarea name="proRemark" class="layui-textarea"></textarea>
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block">
                <input type="hidden" name="proAC" value="project" />
                <button class="layui-btn" lay-submit lay-filter="projectForm">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
              </div>
            </div>
          </form>
        </div>
        <div class="layui-tab-item">
          <table id="proList" lay-filter="proList"></table>
        </div>
        <div class="layui-tab-item">
          <form class="layui-form" action="">
            <div class="layui-form-item">
              <label class="layui-form-label">项目名称</label>
              <div class="layui-input-inline">
                <select id="proId" name="proId" lay-verify="proId" lay-filter="proId" lay-search>
                </select>
              </div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">项目经理</label>
              <div class="layui-input-inline">
                <select id="managerId" name="managerId" xm-select="select" xm-select-search="/project/managerSearch">
                </select>
              </div>
              <i class="layui-icon layui-icon-edit" id="managerDialog" style="font-size: 32px; color: #009688;cursor: pointer"></i>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">项目造价</label>
              <div class="layui-input-inline">
                <input type="text" name="bidsPrice" required  lay-verify="required" placeholder="请输入标段造价" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">元</div>
            </div>
            <div class="layui-form-item">
              <label class="layui-form-label">管理费比例</label>
              <div class="layui-input-inline">
                <input type="text" name="proManagerRatio" required  lay-verify="number" placeholder="请输入项目工期" autocomplete="off" class="layui-input">
              </div>
              <div class="layui-form-mid layui-word-aux">%</div>
            </div>         
            <div class="layui-form-item layui-form-text">
              <label class="layui-form-label">项目描述</label>
              <div class="layui-input-block">
                <textarea name="bidsRemark" placeholder="请输入内容" class="layui-textarea"></textarea>
              </div>
            </div>
            <div class="layui-form-item">
              <div class="layui-input-block">
                <input type="hidden" name="proAC" value="bids" />
                <button class="layui-btn" lay-submit lay-filter="managerForm">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
              </div>
            </div>            
          </form>
        </div>
        <div class="layui-tab-item">
          <table id="bidsList" lay-filter="bidsList"></table>
        </div>
      </div>
    </div>
  </div>
  
  <div class="layui-footer">
    <!-- 底部固定区域 -->
    © 湖南浩宇建设有限公司 - Lee.
  </div>
</div>
<script src="static/layui/layui.js"></script>
<script type="text/html" id="colBar">
  <a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
  <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
//JavaScript代码区域
layui.config({
        base: 'static/layui/lay/modules/'
    }).extend({
        formSelects: 'formSelects-v4',
});
layui.use(['element','laydate','form','formSelects','table','layer'], function(){
  var element = layui.element,
  table = layui.table,
  formSelects = layui.formSelects,
  laydate = layui.laydate,
  form = layui.form,
  $ = layui.$;

  element.on("tab(tab)", function(data){
    switch (data.index) {
      case 1://项目表格        
        table.render({
          elem: '#proList'
          ,id: 'proListReload'
          ,height: 315
          ,url: '/project/projectTableList' //数据接口
          ,page: true //开启分页
          ,cols: [[ //表头
            {field: 'proNumber', title: '项目编号',width: 100, sort: true, fixed: 'left'}
            ,{field: 'proName', title: '项目名称'}
            ,{field: 'proPrice', title: '项目总造价',width: 120}
            ,{field: 'proStart', title: '开工日期',width: 120}
            ,{field: 'proDays', title: '工期（天）',width: 100} 
            ,{field: 'proRemark', title: '合同内容'}
            ,{field: 'proEdit', title: '操作',fixed:'right', align:'center', toolbar: '#colBar'}
          ]]
        });
        break;
      case 2:
        $.ajax({
          url:'/project/projectOptionList',
          method:'GET',
          dataType:'JSON',
          success:function(res){   
            var num = res.data.length;
            var option = "";
            res.data.forEach( function(element, index) {
              option += "<option value='"+element.id+"'>"+element.name+"</option>";
              $("#proId").html(option)
            });
            form.render('select');
          }
        });
        $.ajax({
          url:'/project/managerOptionList',
          method:'GET',
          dataType:'JSON',
          success:function(res){   
            var num = res.data.length;
            var option = "";
            res.data.forEach( function(element, index) {
              option += "<option value='"+element.id+"'>"+element.name+"</option>";
              $("#managerId").html(option)
            });
            form.render('select');
          }
        });
        break;
      case 3://项目经理标段表格        
        table.render({
          elem: '#bidsList'
          ,id:'bidsListReload'
          ,height: 315
<<<<<<< HEAD
          ,url: '/project/managerTableList' //数据接口
=======
          ,url: '/project/projectManagerTableList' //数据接口
>>>>>>> 2b822d6467885a6351505e4261ee1191d8df0146
          ,page: true //开启分页
          ,cols: [[ //表头
            {field: 'id', title: '序号', width:60}
            ,{field: 'projectName', title: '项目名称', width:360}
            ,{field: 'proManName', title: '项目标段经理', width:160}
            ,{field: 'proManPrice', title: '标段造价', width:160}
            ,{field: 'proManRemark', title: '备注'}
            ,{field: 'managerEdit', title: '操作',fixed:'right', align:'center', toolbar: '#colBar'}
          ]]
        });
        break;
    }
  });
  form.on('submit(projectForm)', function(data){
    $.post('/project/projectAdd',data.field,function(res){        
        layer.msg(res.msg);
        //parent.closeIframe(res.msg);
      },'json'
    );
    return false;
  });
  form.on('submit(managerForm)', function(data){
    $.post('/project/managerAdd',data.field,function(res){        
        layer.msg(res.msg);
        //parent.closeIframe(res.msg);
      }
    )
    return false;
  });

  laydate.render({
    elem: '#proStart' //指定元素
  });

  table.on('tool(proList)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
    var data = obj.data; //获得当前行数据
    var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
    var tr = obj.tr; //获得当前行 tr 的DOM对象
   
    if(layEvent === 'detail'){ //查看
      console.log(data);
      //do somehing
    } else if(layEvent === 'del'){ //删除
      layer.confirm('真的删除行么', function(index){
        obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
        layer.close(index);
        //向服务端发送删除指令
      });
    } else if(layEvent === 'edit'){ //编辑
      //do something
      
      //同步更新缓存对应的值
      obj.update({
        username: '123'
        ,title: 'xxx'
      });
    }
  });

  $("#managerDialog").click(function(event) {
    layer.open({
      type: 2,
      area:['600px', '500px'],
      title:"项目经理查询 / 编辑",
      content: "/project/managerDialog" //注意，如果str是object，那么需要字符拼接。
    });
  });
});
</script>
</body>
</html>

